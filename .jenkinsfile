pipeline {
    agent any

    tools {
        maven 'Maven3'   // Must match Jenkins → Tools → Maven name
        jdk 'JDK17'      // Or your configured JDK name
    }

    parameters {
        choice(name: 'ENV', choices: ['qc', 'qa', 'dev'], description: 'Execution environment')
        choice(name: 'PLATFORM', choices: ['web', 'api'], description: 'Execution platform')
        choice(name: 'PROFILE', choices: ['web', 'api'], description: 'Maven profile')
        string(name: 'TAGS', defaultValue: '', description: 'Cucumber tags (optional)')
    }

    stages {

        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Build & Test') {
            steps {
                bat """
                    mvn clean test ^
                    -Denv=${params.ENV} ^
                    -Dplatform=${params.PLATFORM} ^
                    -P${params.PROFILE} ^
                    -Dcucumber.filter.tags="${params.TAGS}"
                """
            }
        }
    }

    post {
        always {
            echo 'Pipeline execution completed'
        }
        success {
            echo 'BUILD SUCCESS'
        }
        failure {
            echo 'BUILD FAILED'
        }
    }
}
